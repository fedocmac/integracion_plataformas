<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"><title>Login</title>
<style>
body{font-family:Arial;margin:2rem;background:#f9f9f9}
form{max-width:360px;margin:auto;background:#fff;padding:2rem;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,.1)}
input,button{width:100%;margin:.5rem 0;padding:.7rem;border:1px solid #ccc;border-radius:5px}
button{background:#007bff;color:#fff;font-weight:bold;cursor:pointer}
button:hover{background:#0056b3}
#msg{text-align:center;margin-top:1rem;font-weight:bold}
.nav{text-align:center;margin-top:1rem}
.nav a{margin:0 .5rem;color:#007bff;text-decoration:none}
</style>
</head>
<body>

<h2 style="text-align:center">Iniciar sesión</h2>

<form id="login-form">
  <input name="username" placeholder="Usuario" required>
  <input name="password" type="password" placeholder="Contraseña" required>
  <button type="submit">Ingresar</button>
</form>

<div id="msg"></div>

<div class="nav">
  <a href="/registrar/">Registro</a> |
  <a href="/confirmar/">Confirmar cuenta</a>
</div>

<script>
document.getElementById("login-form").addEventListener("submit", async e=>{
  e.preventDefault();
  const f=e.target,msg=document.getElementById("msg");
  const payload={username:f.username.value.trim(),password:f.password.value};
  msg.textContent="Verificando…";
  try{
    const r=await fetch("/api/login/",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(payload)
    });
    const res=await r.json().catch(()=>({}));
    if(r.ok){
      localStorage.setItem("accessToken",res.accessToken);
      localStorage.setItem("refreshToken",res.refreshToken);
      msg.textContent="✅ Bienvenido, redirigiendo…";
      setTimeout(()=>location.href="/index/",1000);
    }else if(r.status===400){
      msg.textContent="❌ Credenciales inválidas o usuario no confirmado.";
    }else{
      msg.textContent=res.message||"❌ Error inesperado.";
    }
  }catch{
    msg.textContent="❌ No se pudo conectar con el servidor.";
  }
});
</script>

</body>
</html>
